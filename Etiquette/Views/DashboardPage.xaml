<Page
    x:Name="PageRoot"
    x:Class="Etiquette.Views.DashboardPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:vm="using:Etiquette.ViewModels"
    xmlns:models="using:Etiquette.Models"
    mc:Ignorable="d">

    <Grid Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">
        <Grid.Resources>
            <ThemeShadow x:Name="SharedShadow" />
        </Grid.Resources>

        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*" x:Name="PendingColumn" />

            <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>

        <ScrollViewer Grid.Column="0">
            <StackPanel Spacing="15" Padding="24" Background="{ThemeResource LayerFillColorDefaultBrush}">
                <TextBlock Text="Nouvelle Étiquette" Style="{StaticResource TitleTextBlockStyle}"/>

                <TextBox x:Name="ProductNameTextBox"
                         Header="Nom du produit" 
                         PlaceholderText="Nom du produit"
                         Text="{x:Bind ViewModel.ProductName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                         KeyDown="ProductNameTextBox_KeyDown"/>

                <TextBox x:Name="ScanTextBox"
                         Header="Code / EAN (Scan)" 
                         PlaceholderText="Scannez ici..."
                         Text="{x:Bind ViewModel.ScanInput, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                         FontSize="18"
                         KeyDown="ScanTextBox_KeyDown"/>

                <Button Content="Imprimer seulement" 
                        Command="{x:Bind ViewModel.PrintOnlyCommand}"
                        HorizontalAlignment="Stretch"/>

                <Border Height="1" Background="{ThemeResource SystemControlForegroundBaseMediumLowBrush}" Opacity="0.4" Margin="0,10"/>

                <TextBlock Text="Aperçu impression" Style="{StaticResource SubtitleTextBlockStyle}"/>

                <Grid>
                    <Border CornerRadius="4" Background="{ThemeResource ApplicationPageBackgroundThemeBrush}" Margin="0,0,-10,-10"/>

                    <Border x:Name="LabelPreviewContainer" 
                            BorderBrush="Black" BorderThickness="2" CornerRadius="4" Background="White" 
                            Padding="15" HorizontalAlignment="Center" Width="250"
                            Shadow="{StaticResource SharedShadow}" Translation="0,0,32">
                        <StackPanel>
                            <TextBlock Text="{x:Bind ViewModel.ProductName, Mode=OneWay}" 
                                       Foreground="Black" FontWeight="Bold" FontSize="18" 
                                       HorizontalAlignment="Center" TextAlignment="Center" TextWrapping="Wrap"
                                       Visibility="{x:Bind ViewModel.ProductName, Converter={StaticResource StringVisibilityConverter}, Mode=OneWay}"/>

                            <TextBlock Text="{x:Bind ViewModel.ScanInput, Mode=OneWay}" 
                                       Foreground="Black" FontSize="14" Margin="0,5,0,10"
                                       HorizontalAlignment="Center" FontFamily="Consolas"/>

                            <Border Height="2" Background="Black" Margin="0,0,0,10"/>

                            <Image Source="{x:Bind ViewModel.QrCodeImage, Mode=OneWay}" 
                                   Height="150" Width="150" Stretch="Uniform"/>
                        </StackPanel>
                    </Border>
                </Grid>

                <Button Content="Sauvegarder et imprimer" 
                        Command="{x:Bind ViewModel.ProcessScanCommand}"
                        HorizontalAlignment="Stretch"
                        Style="{StaticResource AccentButtonStyle}"
                        Height="45" FontSize="16" Margin="0,10,0,0"/>
            </StackPanel>
        </ScrollViewer>

        <Grid Grid.Column="1" Padding="24">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="1.5*"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="2*"/>
            </Grid.RowDefinitions>

            <InfoBar Grid.Row="0" Margin="0,0,0,10"
                     IsOpen="{x:Bind ViewModel.IsInfoBarOpen, Mode=TwoWay}"
                     Severity="{x:Bind ViewModel.InfoBarSeverity, Mode=OneWay}"
                     Title="{x:Bind ViewModel.InfoBarTitle, Mode=OneWay}"
                     Message="{x:Bind ViewModel.InfoBarMessage, Mode=OneWay}"
                     IsClosable="True"/>

            <Grid Grid.Row="1" Margin="0,0,0,10" ColumnSpacing="15">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Orientation="Horizontal" Spacing="10" VerticalAlignment="Center">
                    <FontIcon Glyph="&#xE753;" FontFamily="Segoe MDL2 Assets" FontSize="20"/>
                    <TextBlock Text="Flux" Style="{StaticResource TitleTextBlockStyle}"/>
                </StackPanel>

                <TextBox Grid.Column="1" 
                         PlaceholderText="Rechercher (Nom, EAN...)" 
                         Text="{x:Bind ViewModel.SearchText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                    <TextBox.Header>
                        <TextBlock Text="Filtres" FontSize="12" Foreground="Gray"/>
                    </TextBox.Header>
                </TextBox>

                <Button Grid.Column="2" VerticalAlignment="Bottom" Command="{x:Bind ViewModel.RefreshHistoryCommand}" ToolTipService.ToolTip="Actualiser">
                    <FontIcon Glyph="&#xE72C;" FontFamily="Segoe MDL2 Assets"/>
                </Button>
            </Grid>

            <Grid Grid.Row="2" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" CornerRadius="8" Padding="10">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <Grid Grid.Row="0" Margin="0,0,0,10">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel Orientation="Horizontal" Spacing="10">
                        <FontIcon Glyph="&#xE9D9;" FontFamily="Segoe MDL2 Assets" Foreground="Orange"/>
                        <TextBlock Text="En attente (Scanettes Mobile)" FontWeight="Bold"/>
                        <TextBlock Text="{x:Bind ViewModel.PendingList.Count, Mode=OneWay}" Foreground="Gray"/>
                    </StackPanel>

                    <Button Grid.Column="1" 
                            Command="{x:Bind ViewModel.PrintAllPendingCommand}"
                            Style="{StaticResource AccentButtonStyle}"
                            Visibility="{x:Bind ViewModel.PendingList.Count, Converter={StaticResource StringVisibilityConverter}, Mode=OneWay}">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <FontIcon Glyph="&#xE749;" FontFamily="Segoe MDL2 Assets"/>
                            <TextBlock Text="Tout imprimer"/>
                        </StackPanel>
                    </Button>
                </Grid>

                <ListView Grid.Row="1" ItemsSource="{x:Bind ViewModel.PendingList, Mode=OneWay}" SelectionMode="None">
                    <ListView.ItemTemplate>
                        <DataTemplate x:DataType="models:ProductLabel">
                            <Grid Padding="8" BorderBrush="LightGray" BorderThickness="0,0,0,1">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel>
                                    <TextBlock Text="{x:Bind ProductName}" FontWeight="SemiBold"/>
                                    <TextBlock Text="{x:Bind BarcodeContent}" FontSize="12" Foreground="Gray"/>
                                </StackPanel>

                                <Button Grid.Column="1" 
                                        Style="{StaticResource AccentButtonStyle}"
                                        Content="Imprimer"
                                        Command="{Binding ElementName=PageRoot, Path=ViewModel.ProcessPendingItemCommand}"
                                        CommandParameter="{Binding}"/>
                            </Grid>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>
            </Grid>

            <Grid Grid.Row="3" Margin="0,15">
                <Border Height="1" Background="Gray" Opacity="0.2"/>
            </Grid>

            <Grid Grid.Row="4">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <StackPanel Orientation="Horizontal" Spacing="10" Margin="0,0,0,10">
                    <FontIcon Glyph="&#xE81C;" FontFamily="Segoe MDL2 Assets" Foreground="Green"/>
                    <TextBlock Text="Historique (Imprimé)" FontWeight="Bold"/>
                </StackPanel>

                <ListView Grid.Row="1" ItemsSource="{x:Bind ViewModel.HistoryList, Mode=OneWay}" SelectionMode="None">
                    <ListView.ItemTemplate>
                        <DataTemplate x:DataType="models:ProductLabel">
                            <Grid Padding="12" CornerRadius="4" Margin="0,4" Background="{ThemeResource LayerFillColorDefaultBrush}">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <FontIcon Glyph="&#xE930;" FontFamily="Segoe MDL2 Assets" FontSize="20" Margin="0,0,12,0" Foreground="Gray"/>

                                <StackPanel Grid.Column="1">
                                    <TextBlock Text="{x:Bind ProductName}" FontWeight="Bold"/>
                                    <TextBlock Text="{x:Bind BarcodeContent}" FontSize="12" FontFamily="Consolas"/>
                                </StackPanel>

                                <TextBlock Grid.Column="2" Text="{x:Bind Source}" FontSize="11" Margin="10,0" VerticalAlignment="Center" Foreground="Gray"/>

                                <StackPanel Grid.Column="3" Orientation="Horizontal" Spacing="5">
                                    <Button Background="Transparent" BorderThickness="0"
                                            ToolTipService.ToolTip="Recharger pour modifier"
                                            Command="{Binding ElementName=PageRoot, Path=ViewModel.LoadLabelForEditingCommand}"
                                            CommandParameter="{Binding}">
                                        <FontIcon Glyph="&#xE898;" FontFamily="Segoe MDL2 Assets" Foreground="{ThemeResource SystemAccentColor}"/>
                                    </Button>
                                    <Button Background="Transparent" BorderThickness="0"
                                            ToolTipService.ToolTip="Supprimer"
                                            Command="{Binding ElementName=PageRoot, Path=ViewModel.DeleteLabelCommand}"
                                            CommandParameter="{Binding}">
                                        <FontIcon Glyph="&#xE74D;" FontFamily="Segoe MDL2 Assets" Foreground="IndianRed"/>
                                    </Button>
                                </StackPanel>
                            </Grid>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>
            </Grid>
        </Grid>
    </Grid>
</Page>